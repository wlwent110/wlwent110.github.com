<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <style>

        * {
            box-sizing: border-box;
        }
        h3{
            text-align:center;
        }
        .g2048{
            border-radius: 10px;
            border: 4px solid #bbad9e;
            width: 500px;
            height: 500px;
            margin: 30px auto;
            position: relative;
        }
        .cell{
            float: left;
            height: 25%;
            width: 25%;
            box-sizing:border-box;
            border: 4px solid #bbad9e;
            border-radius: 10px;
        }
        .number_cell{
            position: absolute;
            box-sizing:border-box;
            width: 25%;
            height: 25%;
            padding: 4px;
            left: 0;
            top: 0;
            transition: all 0.2s;
            color: #fff;
            font-size: 20px;
            border-radius: 10px;
        }
        .number_cell_con{
            width: 100%;
            height: 100%;
            text-align: center;
            position: relative;
        }
        .number_cell_con span{
            position: absolute;
            top: 50%;
            margin-top: -0.5em;
            left: 0;
            right: 0;
        }
        /*位置*/
        .p00{left:0;top:0;} .p01{left:0; top:25%; } .p02{left:0; top:50%; } .p03{left:0; top:75%; } .p10{left:25%; top:0; } .p11{left:25%; top:25%; } .p12{left:25%; top:50%; } .p13{left:25%; top:75%; } .p20{left:50%; top:0; } .p21{left:50%; top:25%; } .p22{left:50%; top:50%; } .p23{left:50%; top:75%; } .p30{left:75%; top:0; } .p31{left:75%; top:25%; } .p32{left:75%; top:50%; } .p33{left:75%; top:75%; }
        /*颜色*/
        .n2{background: #eee4da; color: #000; } .n4{background: #ece0c8; color: #000; } .n8{background:#f3b179; } .n16{background:#f59563; } .n32{background:#f67c5f; } .n64{background:#f65e3c; } .n128{background:#edce71; } .n256{background:#eccb61; } .n512{background:#edc750; } .n1024{background:#edc631; } .n2048{background:#edc12f; }

    </style>
</head>
<body>
<h3 id="score">分数：0</h3>
<div class="g2048">
    <div class="cell"></div>
    <div class="cell"></div>
    <div class="cell"></div>
    <div class="cell"></div>
    <div class="cell"></div>
    <div class="cell"></div>
    <div class="cell"></div>
    <div class="cell"></div>
    <div class="cell"></div>
    <div class="cell"></div>
    <div class="cell"></div>
    <div class="cell"></div>
    <div class="cell"></div>
    <div class="cell"></div>
    <div class="cell"></div>
    <div class="cell"></div>
</div>


<script src="https://apps.bdimg.com/libs/jquery/1.8.1/jquery.min.js"></script>

<script >
    var span=document.querySelector('#score');
    var list={
        array:["","","","","","","","","","","","","","","",""],
        place_arr:['00','10','20','30','01','11','21','31','02','12','22','32','03','13','23','33'],
        old_arr:["","","","","","","","","","","","","","","",""],
        scroe:0,

        setnumber:function () {
            var listRandom = [];
            for (var i = 0; i <= 15; i++) {
                listRandom.push(i);
            }
            var num1 = parseInt(16 * Math.random());
            listRandom.splice(num1, 1);
            var num2 = listRandom[parseInt(15 * Math.random())];
            list.array[num1]=2;
            list.array[num2]=2;
            create(num1);
            create(num2);

        },
        addnum:function () {
            var num = parseInt(16*Math.random());
            if (list.array.indexOf("") < 0) {
                return ;
            } else if (!list.array[num]) {
                list.array[num]=2;
                create(num);
            } else {
                list.addnum();
            }
        },

        logic:function (arr) {
            var isMove = false;
            for (var j = 0; j < 4; j++) {
                //如果除了第一个以外，第二个开始只要没有值且之前一个有值，就会把第一个移动到第二个，循环如果第三个没有值就把第二个移动到第三个
               var active= function () {
                    for (var i = 0; i < 4; i++) {
                        if (!list.array[arr[j][i]] && list.array[arr[j][i-1]]&& i > 0) {
                            list.array[arr[j][i]]=list.array[arr[j][i-1]];

                            list.drawCell(arr[j][i],arr[j][i-1]);
                            list.array[arr[j][i-1]]='';
                            isMove = true;
                            active();
                        }
                        //如果第前一个和后一个值相等，则相加
                        if(list.array[arr[j][i]]){
                            if(list.array[arr[j][i]]== list.array[arr[j][i-1]]){

                                list.scroe+=list.array[arr[j][i]]+ list.array[arr[j][i-1]];

                                list.array[arr[j][i]]+=list.array[arr[j][i-1]];
                                list.drawCell(arr[j][i],arr[j][i-1]);
                                span.innerText='你的得分是：'+list.scroe;
                                list.array[arr[j][i-1]]='';
                                isMove = true;
                                active();
                            }
                        }

                    }
                }
                active();



            }

            if (isMove == true) {
                list.addnum();
            }

            setTimeout(function () {
                var isGameOver = list.check();
                if (isGameOver == 'over') {
                    alert('抱歉失败了噢~');
                } else if (isGameOver == 'success') {
                    alert('恭喜成功啦！');
                }
            },500)
        },
        check:function () {
            if (list.array.indexOf(2048) >= 0) {
                return 'success';
            } else if (list.array.indexOf("") < 0) {

                var b=[4,1];
                var flag=false;
                out:
                        for(var i=0;i<16;i++){
                            for(var j=0;j<2;j++){

                                if(!(j==1&&(i==3||i==7||i==11))){
                                    if((i+b[j])>=0){
                                        if(list.array[i]==list.array[i+b[j]]){
                                            flag=true;
                                            break out;
                                        }
                                    }
                                }

                            }

                        }
                if(!flag){
                    return 'over';
                }
            }
        },
        down:function () {
            var arr = [
                [0,4,8,12],
                [1,5,9,13],
                [2,6,10,14],
                [3,7,11,15]
            ];
            list.logic(arr);
        },
        up:function () {
            var arr = [
                [12,8,4,0],
                [13,9,5,1],
                [14,10,6,2],
                [15,11,7,3]
            ];
            list.logic(arr);
        },
        right:function () {
            var arr = [
                [0,1,2,3],
                [4,5,6,7],
                [8,9,10,11],
                [12,13,14,15]
            ];
            list.logic(arr);
        },
        left:function () {
            var arr = [
                [3,2,1,0],
                [7,6,5,4],
                [11,10,9,8],
                [15,14,13,12]
            ];
            list.logic(arr);
        },

            drawCell:function(num,oldnum){
                //移动合并
                $(".p"+list.place_arr[num]).addClass('toRemove');
                var theDom = $(".p"+list.place_arr[ oldnum]).removeClass("p"+list.place_arr[oldnum]).addClass("p"+list.place_arr[num]).find('.number_cell_con');
                setTimeout(function(){
                    $(".toRemove").remove();//这个写法不太好
                    theDom.removeClass('n'+list.array[oldnum]).addClass('n'+list.array[num]).find('span').html(list.array[num]);
                },200);//200毫秒是移动耗时。
    }

    }
    function create(num){
        /*画一个新格子*/
        var item = '<div class="number_cell p'+list.place_arr[num]+'" ><div class="number_cell_con n2"><span>'
                +list.array[num]+'</span></div> </div>';
        $(".g2048").append(item);
    }
    window.addEventListener('keydown', function (e) {
        if (e.keyCode == 37) {
            list.left();
        } else if (e.keyCode == 38) {
            list.up();
        } else if (e.keyCode == 39) {
            list.right();
        } else if (e.keyCode == 40) {
            list.down();
        }


    });
list.setnumber();
</script>
</body>
</html>